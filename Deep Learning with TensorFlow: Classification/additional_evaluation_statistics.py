
'''
Additional evaluation statistics
15 min
Sometimes having only accuracy reported is not enough or adequate. Accuracy is often used when data is balanced, meaning it contains an equal or almost equal number of samples from all the classes. However, oftentimes data comes imbalanced. For example in medicine, the rate of a disease is low. In these cases, reporting another metric such as F1-score is more adequate.

Frequently, we want to consider both false negatives and false positives when evaluating our model. Maybe we want to find a model that is a balance between precision and recall. For example, if we are building a relevancy classifier for Twitter that spots mentions about toys, it might be equally bad to miss a (relevant) toy mention as to misclassify a non-toy (irrelevant) mention. Luckily, an F1-score is a helpful way to evaluate our model that takes both precision and recall into account with the harmonic mean.

To observe the F1-score of a trained model instance my_model, amongst other metrics, we use sklearn.metrics.classification_report:

import numpy as np
from sklearn.metrics import classification_report
yhat_classes = np.argmax(my_model.predict(my_test), axis=1)
y_true = np.argmax(my_test_labels, axis=1)
print(classification_report(y_true, yhat_classes))

In the code above we do the following:

predict classes for all test cases my_test using the .predict() method and assign the result to the yhat_classes variable.
using .argmax() convert the one-hot-encoded labels my_test_labels into the index of the class the sample belongs to. The index corresponds to our class encoded as an integer.
use the .classification_report() method to calculate all the metrics.



verbose=0: No output is shown.
verbose=1: Displays progress messages (e.g., progress bar for each epoch).
verbose=2: Displays one line per epoch.


1.
Using the Model.predict() method, get the predictions for your test data x_test using the trained model instance model. Assign the result to a variable called y_estimate.


2.
Using np.argmax() convert the one-hot encoded labels y_estimate into the index of the class each sample in the test data belongs to with the axis parameter set to 1. Assign the result to y_estimate.


3.
Using np.argmax() convert the one-hot encoded labels y_test into the index of the class each sample in the test data belongs to with the axis parameter set to 1. Assign the result to y_true.

4.
Using sklearn.metrics.classification_report, print additional metrics, such as F1-score calculated between the true y_true and estimated test data labels y_estimate.



'''

import pandas as pd
from collections import Counter
from sklearn.preprocessing import LabelEncoder
import tensorflow
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import  InputLayer
from tensorflow.keras.layers import  Dense
from sklearn.metrics import classification_report
import numpy as np
#your code here

train_data = pd.read_csv("air_quality_train.csv")
test_data = pd.read_csv("air_quality_test.csv")

#print columns and their respective types
print(train_data.info())
#print the class distribution
print(Counter(train_data["Air_Quality"]))
#extract the features from the training data
x_train = train_data[['PM2.5', 'PM10', 'NO', 'NO2', 'NOx', 'NH3', 'CO', 'SO2', 'O3', 'Benzene', 'Toluene', 'Xylene', 'AQI']]
#extract the label column from the training data
y_train = train_data["Air_Quality"]
#extract the features from the test data
x_test = test_data[['PM2.5', 'PM10', 'NO', 'NO2', 'NOx', 'NH3', 'CO', 'SO2', 'O3', 'Benzene', 'Toluene', 'Xylene', 'AQI']]
#extract the label column from the test data
y_test = test_data["Air_Quality"]

#encode the labels into integers
le = LabelEncoder()
#convert the integer encoded labels into binary vectors
y_train=le.fit_transform(y_train.astype(str))
y_test=le.transform(y_test.astype(str))
#convert the integer encoded labels into binary vectors
y_train = tensorflow.keras.utils.to_categorical(y_train, dtype = 'int64')
y_test = tensorflow.keras.utils.to_categorical(y_test, dtype = 'int64')

#design the model
model = Sequential()
#add the input layer
model.add(InputLayer(input_shape=(x_train.shape[1],)))
#add a hidden layer
model.add(Dense(10, activation='relu'))
#add an output layer
model.add(Dense(6, activation='softmax'))

#compile the model
model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])

#train and evaluate the model
model.fit(x_train, y_train, epochs = 20, batch_size = 16, verbose = 1)

#get additional statistics

# y_true = np.argmax(my_test_labels, axis=1)
# print(classification_report(y_true, yhat_classes))

y_estimate = model.predict(x_test)
y_estimate = np.argmax(y_estimate, axis=1)

y_true = np.argmax(y_test, axis = 1)

print(classification_report(y_true, y_estimate))




'''
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 7782 entries, 0 to 7781
Data columns (total 14 columns):
PM2.5          7782 non-null float64
PM10           7782 non-null float64
NO             7782 non-null float64
NO2            7782 non-null float64
NOx            7782 non-null float64
NH3            7782 non-null float64
CO             7782 non-null float64
SO2            7782 non-null float64
O3             7782 non-null float64
Benzene        7782 non-null float64
Toluene        7782 non-null float64
Xylene         7782 non-null float64
AQI            7782 non-null float64
Air_Quality    7782 non-null object
dtypes: float64(13), object(1)
memory usage: 851.3+ KB
None
Counter({'Very Poor': 1297, 'Poor': 1297, 'Moderate': 1297, 'Satisfactory': 1297, 'Severe': 1297, 'Good': 1297})
Epoch 1/20

  1/487 [..............................] - ETA: 0s - loss: 61.5631 - accuracy: 0.0625
 66/487 [===>..........................] - ETA: 0s - loss: 40.5758 - accuracy: 0.1581
130/487 [=======>......................] - ETA: 0s - loss: 28.9789 - accuracy: 0.1601
175/487 [=========>....................] - ETA: 0s - loss: 24.5066 - accuracy: 0.1711
242/487 [=============>................] - ETA: 0s - loss: 20.5657 - accuracy: 0.1862
300/487 [=================>............] - ETA: 0s - loss: 18.0520 - accuracy: 0.2052
369/487 [=====================>........] - ETA: 0s - loss: 15.8777 - accuracy: 0.2251
429/487 [=========================>....] - ETA: 0s - loss: 14.4211 - accuracy: 0.2397
487/487 [==============================] - 0s 816us/step - loss: 13.2930 - accuracy: 0.2540
Epoch 2/20

  1/487 [..............................] - ETA: 0s - loss: 4.5063 - accuracy: 0.4375
 64/487 [==>...........................] - ETA: 0s - loss: 4.1458 - accuracy: 0.3877
129/487 [======>.......................] - ETA: 0s - loss: 3.9849 - accuracy: 0.4031
189/487 [==========>...................] - ETA: 0s - loss: 3.7304 - accuracy: 0.4196
254/487 [==============>...............] - ETA: 0s - loss: 3.6302 - accuracy: 0.4252
314/487 [==================>...........] - ETA: 0s - loss: 3.5048 - accuracy: 0.4379
381/487 [======================>.......] - ETA: 0s - loss: 3.3685 - accuracy: 0.4414
441/487 [==========================>...] - ETA: 0s - loss: 3.2760 - accuracy: 0.4490
487/487 [==============================] - 0s 797us/step - loss: 3.1970 - accuracy: 0.4518
Epoch 3/20

  1/487 [..............................] - ETA: 0s - loss: 2.9839 - accuracy: 0.3750
 66/487 [===>..........................] - ETA: 0s - loss: 2.4902 - accuracy: 0.4754
127/487 [======>.......................] - ETA: 0s - loss: 2.3752 - accuracy: 0.5000
194/487 [==========>...................] - ETA: 0s - loss: 2.3118 - accuracy: 0.5055
254/487 [==============>...............] - ETA: 0s - loss: 2.2397 - accuracy: 0.5047
320/487 [==================>...........] - ETA: 0s - loss: 2.2099 - accuracy: 0.5100
381/487 [======================>.......] - ETA: 0s - loss: 2.1574 - accuracy: 0.5146
446/487 [==========================>...] - ETA: 0s - loss: 2.1115 - accuracy: 0.5192
487/487 [==============================] - 0s 792us/step - loss: 2.0853 - accuracy: 0.5191
Epoch 4/20

  1/487 [..............................] - ETA: 0s - loss: 0.8451 - accuracy: 0.7500
 68/487 [===>..........................] - ETA: 0s - loss: 1.6428 - accuracy: 0.5478
129/487 [======>.......................] - ETA: 0s - loss: 1.7791 - accuracy: 0.5325
195/487 [===========>..................] - ETA: 0s - loss: 1.7255 - accuracy: 0.5378
255/487 [==============>...............] - ETA: 0s - loss: 1.7099 - accuracy: 0.5397
322/487 [==================>...........] - ETA: 0s - loss: 1.6964 - accuracy: 0.5388
383/487 [======================>.......] - ETA: 0s - loss: 1.6543 - accuracy: 0.5436
449/487 [==========================>...] - ETA: 0s - loss: 1.6367 - accuracy: 0.5475
487/487 [==============================] - 0s 791us/step - loss: 1.6124 - accuracy: 0.5497
Epoch 5/20

  1/487 [..............................] - ETA: 0s - loss: 1.9513 - accuracy: 0.6250
 69/487 [===>..........................] - ETA: 0s - loss: 1.4206 - accuracy: 0.5824
126/487 [======>.......................] - ETA: 0s - loss: 1.3358 - accuracy: 0.5923
187/487 [==========>...................] - ETA: 0s - loss: 1.3514 - accuracy: 0.5842
248/487 [==============>...............] - ETA: 0s - loss: 1.3292 - accuracy: 0.5809
310/487 [==================>...........] - ETA: 0s - loss: 1.3229 - accuracy: 0.5798
372/487 [=====================>........] - ETA: 0s - loss: 1.3172 - accuracy: 0.5827
435/487 [=========================>....] - ETA: 0s - loss: 1.3210 - accuracy: 0.5784
487/487 [==============================] - 0s 821us/step - loss: 1.3102 - accuracy: 0.5794
Epoch 6/20

  1/487 [..............................] - ETA: 0s - loss: 1.2247 - accuracy: 0.6875
 62/487 [==>...........................] - ETA: 0s - loss: 1.2550 - accuracy: 0.5958
118/487 [======>.......................] - ETA: 0s - loss: 1.1393 - accuracy: 0.6112
178/487 [=========>....................] - ETA: 0s - loss: 1.1277 - accuracy: 0.6092
239/487 [=============>................] - ETA: 0s - loss: 1.1410 - accuracy: 0.6106
302/487 [=================>............] - ETA: 0s - loss: 1.1345 - accuracy: 0.6095
363/487 [=====================>........] - ETA: 0s - loss: 1.1308 - accuracy: 0.6102
430/487 [=========================>....] - ETA: 0s - loss: 1.1376 - accuracy: 0.6084
487/487 [==============================] - 0s 824us/step - loss: 1.1235 - accuracy: 0.6101
Epoch 7/20

  1/487 [..............................] - ETA: 0s - loss: 1.0237 - accuracy: 0.5625
 70/487 [===>..........................] - ETA: 0s - loss: 0.9924 - accuracy: 0.6304
130/487 [=======>......................] - ETA: 0s - loss: 1.0209 - accuracy: 0.6284
199/487 [===========>..................] - ETA: 0s - loss: 1.0199 - accuracy: 0.6297
261/487 [===============>..............] - ETA: 0s - loss: 1.0108 - accuracy: 0.6281
330/487 [===================>..........] - ETA: 0s - loss: 1.0008 - accuracy: 0.6292
388/487 [======================>.......] - ETA: 0s - loss: 1.0037 - accuracy: 0.6276
456/487 [===========================>..] - ETA: 0s - loss: 0.9950 - accuracy: 0.6283
487/487 [==============================] - 0s 779us/step - loss: 0.9865 - accuracy: 0.6316
Epoch 8/20

  1/487 [..............................] - ETA: 0s - loss: 0.8777 - accuracy: 0.6250
 69/487 [===>..........................] - ETA: 0s - loss: 0.9097 - accuracy: 0.6440
132/487 [=======>......................] - ETA: 0s - loss: 0.9231 - accuracy: 0.6349
200/487 [===========>..................] - ETA: 0s - loss: 0.8996 - accuracy: 0.6409
261/487 [===============>..............] - ETA: 0s - loss: 0.9215 - accuracy: 0.6430
328/487 [===================>..........] - ETA: 0s - loss: 0.9398 - accuracy: 0.6385
392/487 [=======================>......] - ETA: 0s - loss: 0.9322 - accuracy: 0.6406
459/487 [===========================>..] - ETA: 0s - loss: 0.9142 - accuracy: 0.6458
487/487 [==============================] - 0s 767us/step - loss: 0.9120 - accuracy: 0.6479
Epoch 9/20

  1/487 [..............................] - ETA: 0s - loss: 1.5366 - accuracy: 0.5625
 64/487 [==>...........................] - ETA: 0s - loss: 0.9177 - accuracy: 0.6387
131/487 [=======>......................] - ETA: 0s - loss: 0.8710 - accuracy: 0.6536
196/487 [===========>..................] - ETA: 0s - loss: 0.8493 - accuracy: 0.6693
264/487 [===============>..............] - ETA: 0s - loss: 0.8492 - accuracy: 0.6641
325/487 [===================>..........] - ETA: 0s - loss: 0.8416 - accuracy: 0.6623
393/487 [=======================>......] - ETA: 0s - loss: 0.8436 - accuracy: 0.6621
457/487 [===========================>..] - ETA: 0s - loss: 0.8396 - accuracy: 0.6617
487/487 [==============================] - 0s 769us/step - loss: 0.8319 - accuracy: 0.6642
Epoch 10/20

  1/487 [..............................] - ETA: 0s - loss: 0.9832 - accuracy: 0.7500
 65/487 [===>..........................] - ETA: 0s - loss: 0.8377 - accuracy: 0.6913
135/487 [=======>......................] - ETA: 0s - loss: 0.8120 - accuracy: 0.6884
196/487 [===========>..................] - ETA: 0s - loss: 0.8181 - accuracy: 0.6834
264/487 [===============>..............] - ETA: 0s - loss: 0.8078 - accuracy: 0.6828
328/487 [===================>..........] - ETA: 0s - loss: 0.8060 - accuracy: 0.6825
396/487 [=======================>......] - ETA: 0s - loss: 0.7955 - accuracy: 0.6842
459/487 [===========================>..] - ETA: 0s - loss: 0.7993 - accuracy: 0.6838
487/487 [==============================] - 0s 766us/step - loss: 0.7933 - accuracy: 0.6853
Epoch 11/20

  1/487 [..............................] - ETA: 0s - loss: 0.6923 - accuracy: 0.6875
 70/487 [===>..........................] - ETA: 0s - loss: 0.8090 - accuracy: 0.6777
134/487 [=======>......................] - ETA: 0s - loss: 0.7773 - accuracy: 0.6940
203/487 [===========>..................] - ETA: 0s - loss: 0.7685 - accuracy: 0.6887
265/487 [===============>..............] - ETA: 0s - loss: 0.7867 - accuracy: 0.6804
333/487 [===================>..........] - ETA: 0s - loss: 0.7833 - accuracy: 0.6815
401/487 [=======================>......] - ETA: 0s - loss: 0.7739 - accuracy: 0.6839
469/487 [===========================>..] - ETA: 0s - loss: 0.7663 - accuracy: 0.6876
487/487 [==============================] - 0s 753us/step - loss: 0.7624 - accuracy: 0.6894
Epoch 12/20

  1/487 [..............................] - ETA: 0s - loss: 0.4880 - accuracy: 0.8125
 65/487 [===>..........................] - ETA: 0s - loss: 0.7270 - accuracy: 0.7000
133/487 [=======>......................] - ETA: 0s - loss: 0.7385 - accuracy: 0.6889
201/487 [===========>..................] - ETA: 0s - loss: 0.7118 - accuracy: 0.6968
267/487 [===============>..............] - ETA: 0s - loss: 0.7176 - accuracy: 0.7051
337/487 [===================>..........] - ETA: 0s - loss: 0.7226 - accuracy: 0.7047
402/487 [=======================>......] - ETA: 0s - loss: 0.7289 - accuracy: 0.7051
468/487 [===========================>..] - ETA: 0s - loss: 0.7267 - accuracy: 0.7083
487/487 [==============================] - 0s 763us/step - loss: 0.7299 - accuracy: 0.7087
Epoch 13/20

  1/487 [..............................] - ETA: 0s - loss: 0.9430 - accuracy: 0.7500
 68/487 [===>..........................] - ETA: 0s - loss: 0.6964 - accuracy: 0.7233
135/487 [=======>......................] - ETA: 0s - loss: 0.6891 - accuracy: 0.7245
204/487 [===========>..................] - ETA: 0s - loss: 0.7025 - accuracy: 0.7166
274/487 [===============>..............] - ETA: 0s - loss: 0.7011 - accuracy: 0.7160
337/487 [===================>..........] - ETA: 0s - loss: 0.7019 - accuracy: 0.7164
406/487 [========================>.....] - ETA: 0s - loss: 0.6910 - accuracy: 0.7232
471/487 [============================>.] - ETA: 0s - loss: 0.6856 - accuracy: 0.7245
487/487 [==============================] - 0s 749us/step - loss: 0.6873 - accuracy: 0.7230
Epoch 14/20

  1/487 [..............................] - ETA: 0s - loss: 0.5200 - accuracy: 0.7500
 68/487 [===>..........................] - ETA: 0s - loss: 0.6950 - accuracy: 0.7086
130/487 [=======>......................] - ETA: 0s - loss: 0.6827 - accuracy: 0.7135
194/487 [==========>...................] - ETA: 0s - loss: 0.6941 - accuracy: 0.7084
263/487 [===============>..............] - ETA: 0s - loss: 0.6806 - accuracy: 0.7172
331/487 [===================>..........] - ETA: 0s - loss: 0.6854 - accuracy: 0.7177
391/487 [=======================>......] - ETA: 0s - loss: 0.6777 - accuracy: 0.7207
457/487 [===========================>..] - ETA: 0s - loss: 0.6776 - accuracy: 0.7202
487/487 [==============================] - 0s 775us/step - loss: 0.6789 - accuracy: 0.7200
Epoch 15/20

  1/487 [..............................] - ETA: 0s - loss: 1.1864 - accuracy: 0.6250
 71/487 [===>..........................] - ETA: 0s - loss: 0.6986 - accuracy: 0.7069
134/487 [=======>......................] - ETA: 0s - loss: 0.6715 - accuracy: 0.7164
200/487 [===========>..................] - ETA: 0s - loss: 0.6596 - accuracy: 0.7316
267/487 [===============>..............] - ETA: 0s - loss: 0.6582 - accuracy: 0.7343
333/487 [===================>..........] - ETA: 0s - loss: 0.6557 - accuracy: 0.7344
400/487 [=======================>......] - ETA: 0s - loss: 0.6527 - accuracy: 0.7362
466/487 [===========================>..] - ETA: 0s - loss: 0.6456 - accuracy: 0.7387
487/487 [==============================] - 0s 758us/step - loss: 0.6454 - accuracy: 0.7379
Epoch 16/20

  1/487 [..............................] - ETA: 0s - loss: 0.4583 - accuracy: 0.8750
 70/487 [===>..........................] - ETA: 0s - loss: 0.6603 - accuracy: 0.7366
137/487 [=======>......................] - ETA: 0s - loss: 0.6427 - accuracy: 0.7413
201/487 [===========>..................] - ETA: 0s - loss: 0.6365 - accuracy: 0.7453
269/487 [===============>..............] - ETA: 0s - loss: 0.6382 - accuracy: 0.7477
332/487 [===================>..........] - ETA: 0s - loss: 0.6245 - accuracy: 0.7508
399/487 [=======================>......] - ETA: 0s - loss: 0.6253 - accuracy: 0.7506
466/487 [===========================>..] - ETA: 0s - loss: 0.6249 - accuracy: 0.7505
487/487 [==============================] - 0s 758us/step - loss: 0.6259 - accuracy: 0.7489
Epoch 17/20

  1/487 [..............................] - ETA: 0s - loss: 0.8787 - accuracy: 0.5000
 67/487 [===>..........................] - ETA: 0s - loss: 0.6223 - accuracy: 0.7481
137/487 [=======>......................] - ETA: 0s - loss: 0.6423 - accuracy: 0.7359
200/487 [===========>..................] - ETA: 0s - loss: 0.6347 - accuracy: 0.7416
267/487 [===============>..............] - ETA: 0s - loss: 0.6243 - accuracy: 0.7486
330/487 [===================>..........] - ETA: 0s - loss: 0.6225 - accuracy: 0.7468
399/487 [=======================>......] - ETA: 0s - loss: 0.6227 - accuracy: 0.7481
461/487 [===========================>..] - ETA: 0s - loss: 0.6230 - accuracy: 0.7463
487/487 [==============================] - 0s 763us/step - loss: 0.6222 - accuracy: 0.7478
Epoch 18/20

  1/487 [..............................] - ETA: 0s - loss: 0.4948 - accuracy: 0.7500
 68/487 [===>..........................] - ETA: 0s - loss: 0.5933 - accuracy: 0.7629
132/487 [=======>......................] - ETA: 0s - loss: 0.6033 - accuracy: 0.7661
199/487 [===========>..................] - ETA: 0s - loss: 0.6116 - accuracy: 0.7629
265/487 [===============>..............] - ETA: 0s - loss: 0.6160 - accuracy: 0.7585
332/487 [===================>..........] - ETA: 0s - loss: 0.6099 - accuracy: 0.7575
399/487 [=======================>......] - ETA: 0s - loss: 0.6090 - accuracy: 0.7552
467/487 [===========================>..] - ETA: 0s - loss: 0.6054 - accuracy: 0.7548
487/487 [==============================] - 0s 756us/step - loss: 0.6036 - accuracy: 0.7546
Epoch 19/20

  1/487 [..............................] - ETA: 0s - loss: 0.5194 - accuracy: 0.7500
 65/487 [===>..........................] - ETA: 0s - loss: 0.5697 - accuracy: 0.7673
133/487 [=======>......................] - ETA: 0s - loss: 0.6056 - accuracy: 0.7613
201/487 [===========>..................] - ETA: 0s - loss: 0.6226 - accuracy: 0.7565
265/487 [===============>..............] - ETA: 0s - loss: 0.6171 - accuracy: 0.7594
334/487 [===================>..........] - ETA: 0s - loss: 0.6239 - accuracy: 0.7565
400/487 [=======================>......] - ETA: 0s - loss: 0.6151 - accuracy: 0.7589
469/487 [===========================>..] - ETA: 0s - loss: 0.6150 - accuracy: 0.7576
487/487 [==============================] - 0s 756us/step - loss: 0.6148 - accuracy: 0.7583
Epoch 20/20

  1/487 [..............................] - ETA: 0s - loss: 0.6007 - accuracy: 0.6875
 61/487 [==>...........................] - ETA: 0s - loss: 0.5658 - accuracy: 0.7643
130/487 [=======>......................] - ETA: 0s - loss: 0.5900 - accuracy: 0.7548
193/487 [==========>...................] - ETA: 0s - loss: 0.5802 - accuracy: 0.7655
260/487 [===============>..............] - ETA: 0s - loss: 0.5827 - accuracy: 0.7656
322/487 [==================>...........] - ETA: 0s - loss: 0.5749 - accuracy: 0.7681
390/487 [=======================>......] - ETA: 0s - loss: 0.5675 - accuracy: 0.7718
450/487 [==========================>...] - ETA: 0s - loss: 0.5613 - accuracy: 0.7738
487/487 [==============================] - 0s 787us/step - loss: 0.5594 - accuracy: 0.7733
              precision    recall  f1-score   support

           0       0.52      0.97      0.68       100
           1       0.79      0.87      0.83       508
           2       0.68      0.37      0.48       172
           3       0.90      0.66      0.76       452
           4       0.53      0.70      0.60        37
           5       0.56      0.79      0.65       125

    accuracy                           0.74      1394
   macro avg       0.67      0.73      0.67      1394
weighted avg       0.77      0.74      0.73      1394
'''